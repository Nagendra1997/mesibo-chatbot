<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Mesibo Chatbot Demo</title>

    <link href="chat.css" rel="stylesheet">
    <link href="chatdesign.css" rel="stylesheet">

<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
 <script type="text/javascript" src="https://api.mesibo.com/mesibo.js"></script>


</head>
<!------ Include the above in your HEAD tag ---------->
	<h3> contact@nagendrawhy.com </h3>

<div class="container">
        <hr>

	<div class="row">
	 <div id="Smallchat">
    <div class="Layout Layout-open Layout-expand Layout-right" style="background-color: #3F51B5;color: rgb(255, 255, 255);opacity: 5;border-radius: 10px;">
      <div class="Messenger_messenger">
        <div class="Messenger_header" style="background-color:#00868b ; color: rgb(255, 255, 255);">
          <h4 class="Messenger_prompt"><strong>mesibo chatbot</strong></h4> <span class="chat_close_icon">
             <svg viewBox="0 0 12 12" width="12px" height="12px">
                    <line stroke="#FFFFFF" x1="11.75" y1="0.25" x2="0.25" y2="11.75"></line>
                    <line stroke="#FFFFFF" x1="11.75" y1="11.75" x2="0.25" y2="0.25"></line>
                </svg>

            <i class="fa fa-window-close" aria-hidden="true"></i></span> </div>
        <div class="Messenger_content" >
          <div class="Messages" id='scrollMessage'>
            <div class="Messages_list" id="msglist">

              <div class="date_header" id=dateheader>
                <script type="text/javascript">
                var theDate = new Date();
                dateString = theDate.toString();
                var dateheader = document.getElementById('dateheader');
                dateText = document.createTextNode(dateString.slice(4,10)+","+dateString.slice(10,16));
                dateheader.append(dateText);
                </script>
                <p id="currentDate"></p>
              </div> 

              <div class="incoming_msg">
                  <div class="received_msg">
                        <div class="received_withd_msg">
                          <div class="bot_logo_container">
                          <img src="circle-cropped.png" >
                          <p>Hello. I am mesibo demo bot. Ask me anything about mesibo!</p>
                          </div>
                        </div>
                  </div>
              </div> 

             <!--  <div class="outgoing_msg">
                  <div class="sent_msg">
                        <p>What is mesibo</p>
                  </div>
                </div> -->




            </div>
          </div>
          <div class="Input Input-blank">
            <textarea class="Input_field" placeholder="Send a message..." style="height: 20px;" id='inputfield'></textarea>
            <button class="Input_button Input_button-emoji">
              <div class="Icon" style="width: 18px; height: 18px;">
                <svg width="56px" height="56px" viewBox="1332 47 56 56" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="width: 18px; height: 18px;">
                  <g id="emoji" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(1332.000000, 47.000000)">
                    <path d="M28,56 C12.536027,56 0,43.463973 0,28 C0,12.536027 12.536027,0 28,0 C43.463973,0 56,12.536027 56,28 C56,43.463973 43.463973,56 28,56 Z M28,50 C40.1502645,50 50,40.1502645 50,28 C50,15.8497355 40.1502645,6 28,6 C15.8497355,6 6,15.8497355 6,28 C6,40.1502645 15.8497355,50 28,50 Z" id="Oval-8" fill="#96AAB4" fill-rule="nonzero"></path>
                    <path d="M28,47 C18.0588745,47 10,38.9411255 10,29 C10,27.5224898 11.5469487,26.5550499 12.8754068,27.2017612 C13.0116063,27.2662365 13.0926181,27.3037345 13.1866998,27.3464814 C13.4611235,27.4711684 13.7819537,27.6111958 14.1451774,27.7627577 C15.1908595,28.199088 16.3591406,28.6365764 17.6173846,29.0449298 C21.1841638,30.2025005 24.7379224,30.8945075 28,30.8945075 C31.2620776,30.8945075 34.8158362,30.2025005 38.3826154,29.0449298 C39.6408594,28.6365764 40.8091405,28.199088 41.8548226,27.7627577 C42.2180463,27.6111958 42.5388765,27.4711684 42.8133002,27.3464814 C42.9073819,27.3037345 42.9883937,27.2662365 43.0558366,27.2344634 C44.4530513,26.5550499 46,27.5224898 46,29 C46,38.9411255 37.9411255,47 28,47 Z M28,43 C34.6510529,43 40.2188483,38.3620234 41.6456177,32.1438387 C40.9980758,32.3847069 40.320642,32.6213409 39.6173846,32.8495777 C35.6841638,34.1260741 31.7379224,34.8945075 28,34.8945075 C24.2620776,34.8945075 20.3158362,34.1260741 16.3826154,32.8495777 C15.679358,32.6213409 15.0019242,32.3847069 14.3543823,32.1438387 C15.7811517,38.3620234 21.3489471,43 28,43 Z" id="Oval-8" fill="#96AAB4" fill-rule="nonzero"></path>
                    <path d="M19,15 L19,20 C19,21.1045695 19.8954305,22 21,22 C22.1045695,22 23,21.1045695 23,20 L23,15 C23,13.8954305 22.1045695,13 21,13 C19.8954305,13 19,13.8954305 19,15 Z" id="Line" fill="#96AAB4" fill-rule="nonzero"></path>
                    <path d="M32,15 L32,20 C32,21.1045695 32.8954305,22 34,22 C35.1045695,22 36,21.1045695 36,20 L36,15 C36,13.8954305 35.1045695,13 34,13 C32.8954305,13 32,13.8954305 32,15 Z" id="Line-Copy-2" fill="#96AAB4" fill-rule="nonzero"></path>
                  </g>
                </svg>
              </div>
            </button>
            <button class="Input_button Input_button-send" onclick="sendMessage()">
              <div class="Icon" style="width: 18px; height: 18px;">
                <svg width="57px" height="54px" viewBox="1496 193 57 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="width: 18px; height: 18px;">
                  <g id="Group-9-Copy-3" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(1523.000000, 220.000000) rotate(-270.000000) translate(-1523.000000, -220.000000) translate(1499.000000, 193.000000)">
                    <path d="M5.42994667,44.5306122 L16.5955554,44.5306122 L21.049938,20.423658 C21.6518463,17.1661523 26.3121212,17.1441362 26.9447801,20.3958097 L31.6405465,44.5306122 L42.5313185,44.5306122 L23.9806326,7.0871633 L5.42994667,44.5306122 Z M22.0420732,48.0757124 C21.779222,49.4982538 20.5386331,50.5306122 19.0920112,50.5306122 L1.59009899,50.5306122 C-1.20169244,50.5306122 -2.87079654,47.7697069 -1.64625638,45.2980459 L20.8461928,-0.101616237 C22.1967178,-2.8275701 25.7710778,-2.81438868 27.1150723,-0.101616237 L49.6075215,45.2980459 C50.8414042,47.7885641 49.1422456,50.5306122 46.3613062,50.5306122 L29.1679835,50.5306122 C27.7320366,50.5306122 26.4974445,49.5130766 26.2232033,48.1035608 L24.0760553,37.0678766 L22.0420732,48.0757124 Z" id="sendicon" fill="#96AAB4" fill-rule="nonzero"></path>
                  </g>
                </svg>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!--===============CHAT ON BUTTON STRART===============-->
    <div class="chat_on"> <span class="chat_on_icon">
      <div class="container">
      <img src="https://avatars0.githubusercontent.com/u/19592314?s=460&v=4"></img>
      </div>
      <i class="fa fa-comments" aria-hidden="true"></i>
    </span> 
  </div>
    <!--===============CHAT ON BUTTON END===============-->
  </div>
	</div>
</div>
 <script type="text/javascript">

// CHAT BOT MESSENGER////////////////////////

    	function TestNotify() {

    	}

	TestNotify.prototype.Mesibo_OnConnectionStatus = function(status, value) {
		console.log("TestNotify.prototype.Mesibo_OnConnectionStatus: "  + status);
	}

	TestNotify.prototype.Mesibo_OnMessageStatus = function(m) {
		console.log(m);
		console.log("TestNotify.prototype.Mesibo_OnMessageStatus: from "  + m.peer + " status: " + m.status);
	}

	TestNotify.prototype.Mesibo_OnMessage = function(m, data) {
		console.log("TestNotify.prototype.Mesibo_OnMessage: from "  + m.peer);
    console.log(m);
		if(data){
		var response = new TextDecoder("utf-8").decode(data);
		console.log(response);
		response = JSON.parse(response);	
		//console.log(response['result']['fulfillment']['speech']);	
		//var responseText = response['result']['fulfillment']['speech']; //For dialogflow
			let responseText = response["translations"][0]["translation"]; // For IBM translate
			createRecieveBubble(responseText);

		}
		
	}


    var accessToken ="549c8081b98def7c84641261fc862f9719123dbac20958bebb1195c8";	
    //use admin api to get token - refer documentation at https://mesibo.com
     var api = new Mesibo();
     api.setAppName("chatbot");
     api.setListener(new TestNotify());
     api.setCredentials(accessToken);
     api.start();

	 

 function updateScroll(){
      console.log("Scroll")
      var objDiv = document.getElementById("scrollMessage");
      console.log("objDiv")
      objDiv.scrollTop = objDiv.scrollHeight;
    }

    function sendMessage() {
           var msgdata= document.getElementById("inputfield").value;
           if(msgdata){
            console.log(msgdata);
            createSentBubble(msgdata);
	    document.getElementById("inputfield").value = "";
	
		var p = {};
	       	p.peer = "18885551001";
		var id = api.random();
	     	console.log(p,id,msgdata);
		api.sendMessage(p,id,msgdata);

		  
        }
      }

     

      function createSentBubble(msg_data){
	      console.log("Sent message ===> ", msg_data);      
	var iDiv = document.createElement('div');
        iDiv.className = 'outgoing_msg';
        var innerDiv = document.createElement('div');
        innerDiv.className = 'sent_msg';

        var msgpara=document.createElement('p');
        var msgcontent=document.createTextNode(msg_data);
  
        msgpara.append(msgcontent);
        innerDiv.append(msgpara);
        iDiv.appendChild(innerDiv);

        var mylist = document.getElementById("msglist");
        mylist.appendChild(iDiv);
        updateScroll();
      
      }

    function createRecieveBubble(msg_data){
     
  var iDiv = document.createElement('div');
  iDiv.className = 'incoming_msg';
  var iDiv2 = document.createElement('div');
  iDiv2.className= 'received_msg';
  var innerDiv = document.createElement('div');
  innerDiv.className = 'received_withd_msg';
  var innerDiv2 = document.createElement('div');
  innerDiv2.className = 'bot_logo_container';
  var boticon = document.createElement('img');
  boticon.setAttribute("src","circle-cropped.png");
  var msgpara=document.createElement('p');
  var msgcontent=document.createTextNode(msg_data);
 

  msgpara.append(msgcontent);
  innerDiv2.append(boticon);
  innerDiv2.append(msgpara);
  innerDiv.appendChild(innerDiv2);
  iDiv2.appendChild(innerDiv);
  iDiv.appendChild(iDiv2);

  var mylist = document.getElementById("msglist");
  mylist.appendChild(iDiv);
  updateScroll();
      }

     document.onkeydown = function (e) {
      e = e || window.event;
      switch (e.which || e.keyCode) {
          case 13 : //Your Code Here (13 is ascii code for 'ENTER')
              sendMessage();
              if (event.preventDefault) event.preventDefault();
	      break;
       }

    }


$(document).ready(function(){
    $(".chat_on").click(function(){
        $(".Layout").toggle();
        $(".chat_on").hide(300);
    });
    
       $(".chat_close_icon").click(function(){
        $(".Layout").hide();
           $(".chat_on").show(300);
    });
    
});

 </script>	 
	
	 
